<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                template="/WEB-INF/template/layout.xhtml">

    <ui:define name="content">
        <f:metadata>
            <f:viewParam name="id" value="#{pessoaControle.paramId}"/>
            <f:viewAction action="#{pessoaControle.cadastrar()}"/>
        </f:metadata>

        <p:focus for="form:nome"/>

        <div class="divTitle">
            <p:outputLabel value="Cadastro de Cliente" class="title"/>
        </div>

        <h:form id="form">
            <div class="ui-lg-8 ui-fluid" style="display: flex; margin-left: 16.66%">
                <p:messages id="msg" showSummary="true" closable="true" style="width: 100%"/>
            </div>

            <div class="ui-lg-8 divCorpo" style="display: flex; margin-left: 16.66%">
                <div class="ui-lg-8 ui-fluid" style="padding: 0.3125rem">
                    <p:outputLabel for="nome" value="Nome:"/>
                    <p:inputText id="nome"
                                 value="#{pessoaControle.pessoa.nome}"
                                 required="true"
                                 requiredMessage="Nome é obrigatório!"
                                 style="width: 100%; margin-top: 0.3125rem"
                                 class="textUpperCase"/> 
                </div>

                <div class="ui-lg-4 ui-fluid" style="padding: 0.3125rem">
                    <h:panelGroup id="idade">
                        <p:outputLabel for="nascimento" value="Nascimento: #{pessoaControle.exibirIdade()}"/>
                        <p:datePicker id="nascimento"
                                      required="true"
                                      requiredMessage="Nascimento é obrigatório!"
                                      value="#{pessoaControle.pessoa.nascimento}" 
                                      style="width: 100%; margin-top: 0.3125rem">

                            <p:ajax event="dateSelect" 
                                    listener="#{pessoaControle.calcularIdade()}"
                                    update="form"/>
                        </p:datePicker>
                    </h:panelGroup>
                </div>
            </div>

            <div class="ui-lg-8 divCorpo" style="display: flex; margin-left: 16.66%">                
                <div class="ui-lg-4 ui-fluid" style="padding: 0.3125rem">
                    <p:outputLabel for="sexo" value="Sexo:"/>
                    <p:selectOneRadio id="sexo" value="#{pessoaControle.pessoa.sexo}" layout="lineDirection">
                        <f:selectItems value="#{pessoaControle.sexosPessoa}" var="sexo" itemLabel="#{sexo.descricao}" itemValue="#{sexo}" />
                    </p:selectOneRadio>
                </div>
            </div>

            <div class="ui-lg-8" style="display: flex; margin-left: 16.66%; margin-top: 20px">
                <p:commandButton value="Incluir Endereço" 
                                 actionListener="#{pessoaControle.novoEndereco()}"
                                 immediate="true"
                                 styleClass="ui-button-info"
                                 icon="pi pi-plus"/>
            </div>

            <div class="ui-lg-8 divCorpo" style="display: flex; margin-left: 16.66%">                
                <div class="ui-lg-12 ui-fluid" style="padding: 0.3125rem">
                    <p:dataTable id="tabela" 
                                 var="endereco" 
                                 value="#{pessoaControle.pessoa.enderecos}" 
                                 paginator="true" 
                                 paginatorPosition="bottom" 
                                 rows="5"
                                 emptyMessage="Nenhum endereço cadastrado.">

                        <p:column headerText="Código" width="5%" style="text-align: center">
                            <h:outputText value="#{endereco.id}" />
                        </p:column>

                        <p:column headerText="Logradouro" width="20%" style="text-align: center">
                            <h:outputText value="#{endereco.logradouro}" />
                        </p:column>

                        <p:column headerText="Nº" width="5%" style="text-align: center">
                            <h:outputText value="#{endereco.numero}" />
                        </p:column>

                        <p:column headerText="CEP" width="10%" style="text-align: center">
                            <h:outputText value="#{endereco.cep}" />
                        </p:column>

                        <p:column headerText="Cidade" width="20%" style="text-align: center">
                            <h:outputText value="#{endereco.cidadeLabel}" />
                        </p:column>

                        <p:column headerText="Remover" width="5%" style="text-align: center">
                            <p:commandLink actionListener="#{pessoaControle.removerEndereco(endereco)}" immediate="true" update="form:tabela">
                                <i class="pi pi-trash" style="color: red"/>
                                <p:confirm type="popup" header="Confirmation" message="Deseja realmente excluir este registro?" icon="pi pi-exclamation-triangle"/>
                            </p:commandLink>

                            <p:confirmPopup global="true">
                                <p:commandButton value="Não" type="button" styleClass="ui-confirm-popup-no ui-button-flat"/>
                                <p:commandButton value="Sim" type="button" styleClass="ui-confirm-popup-yes" />
                            </p:confirmPopup>
                        </p:column>
                    </p:dataTable>
                </div>
            </div>

            <div class="btnGroup mt30">
                <p:commandButton value="Salvar" 
                                 action="#{pessoaControle.salvar()}" 
                                 update="form:nome form:nascimento form:msg"
                                 process="@form"
                                 styleClass="ui-button-success" 
                                 icon="pi pi-save"/>

                <p:commandButton value="Cancelar" 
                                 action="list?faces-redirect=true" 
                                 styleClass="ui-button-secondary" 
                                 style="margin-left: 0.625rem"
                                 icon="pi pi-save"/>
            </div>
        </h:form>

        <h:form id="dialogForm">
            <p:dialog header="Incluir Endereço"
                      widgetVar="dialogEndereco"
                      modal="true"
                      height="400"
                      width="600"
                      resizable="false"
                      draggable="true">

                <h:panelGroup id="enderecoFormGroup">

                    <p:messages showSummary="true" closable="true"/>

                    <div class="ui-lg-12 ui-fluid">
                        <p:outputLabel for="logradouro" value="Logradouro:"/>
                        <p:inputText id="logradouro"
                                     value="#{pessoaControle.endereco.logradouro}" 
                                     required="true"
                                     requiredMessage="Logradouro é obrigatório!"
                                     style="margin-top: 0.3125rem"
                                     class="textUpperCase" /> 
                    </div>

                    <div class="ui-lg-12 ui-fluid" style="display: flex; padding-left: 0px; padding-right: 0px">
                        <div class="ui-lg-6 ui-fluid">
                            <p:outputLabel for="numero" value="Número:"/>
                            <p:inputText id="numero" 
                                         value="#{pessoaControle.endereco.numero}" 
                                         required="true"
                                         requiredMessage="Número é obrigatório!"
                                         style="margin-top: 0.3125rem"/> 
                        </div>

                        <div class="ui-lg-6 ui-fluid">
                            <p:outputLabel for="cep" value="CEP:"/>
                            <p:inputText id="cep" 
                                         value="#{pessoaControle.endereco.cep}" 
                                         maxlength="8"
                                         required="true"
                                         requiredMessage="CEP é obrigatório!"
                                         style="margin-top: 0.3125rem"/> 
                        </div>
                    </div>

                    <div class="ui-lg-12 ui-fluid" style="display: flex; padding-left: 0px; padding-right: 0px">
                        <div class="ui-lg-6 ui-fluid">
                            <p:outputLabel for="cidade" value="Cidade:"/>
                            <p:inputText id="cidade" 
                                         value="#{pessoaControle.endereco.cidade}" 
                                         required="true"
                                         requiredMessage="Cidade é obrigatória!"
                                         style="margin-top: 0.3125rem"
                                         class="textUpperCase"/> 
                        </div>

                        <div class="ui-lg-6 ui-fluid">
                            <p:outputLabel for="estado" value="Estado"/>
                            <p:selectOneMenu id="estado" 
                                             value="#{pessoaControle.endereco.estado}" 
                                             required="true" 
                                             requiredMessage="Estado é obrigatório!">

                                <f:selectItem itemLabel="Selecione" itemValue="" />
                                <f:selectItem itemLabel="AC" itemValue="AC"/>
                                <f:selectItem itemLabel="AL" itemValue="AL"/>
                                <f:selectItem itemLabel="AM" itemValue="AM"/>
                                <f:selectItem itemLabel="AP" itemValue="AP"/>
                                <f:selectItem itemLabel="BA" itemValue="BA"/>
                                <f:selectItem itemLabel="CE" itemValue="CE"/>
                                <f:selectItem itemLabel="DF" itemValue="DF"/>
                                <f:selectItem itemLabel="ES" itemValue="ES"/>
                                <f:selectItem itemLabel="GO" itemValue="GO"/>
                                <f:selectItem itemLabel="MA" itemValue="MA"/>
                                <f:selectItem itemLabel="MG" itemValue="MG"/>
                                <f:selectItem itemLabel="MS" itemValue="MS"/>
                                <f:selectItem itemLabel="MT" itemValue="MT"/>
                                <f:selectItem itemLabel="PA" itemValue="PA"/>
                                <f:selectItem itemLabel="PB" itemValue="PB"/>
                                <f:selectItem itemLabel="PE" itemValue="PE"/>
                                <f:selectItem itemLabel="PI" itemValue="PI"/>
                                <f:selectItem itemLabel="PR" itemValue="PR"/>
                                <f:selectItem itemLabel="RJ" itemValue="RJ"/>
                                <f:selectItem itemLabel="RN" itemValue="RN"/>
                                <f:selectItem itemLabel="RO" itemValue="RO"/>
                                <f:selectItem itemLabel="RR" itemValue="RR"/>
                                <f:selectItem itemLabel="RS" itemValue="RS"/>
                                <f:selectItem itemLabel="SC" itemValue="SC"/>
                                <f:selectItem itemLabel="SE" itemValue="SE"/>
                                <f:selectItem itemLabel="SP" itemValue="SP"/>
                                <f:selectItem itemLabel="TO" itemValue="TO"/>
                            </p:selectOneMenu>
                        </div>
                    </div>

                </h:panelGroup>

                <div class="ui-lg-12 ui-fluid" style="display: flex; margin-top: 20px; padding-left: 0px; padding-right: 0px">
                    <div class="ui-lg-6 ui-fluid">
                        <p:commandButton value="Confirmar" 
                                         action="#{pessoaControle.addEndereco()}"
                                         update="dialogForm:enderecoFormGroup form:tabela"
                                         process="@form"
                                         oncomplete="if (args &amp;&amp; !args.validationFailed) PF('dialogEndereco').hide();"
                                         styleClass="ui-button-success" 
                                         icon="pi pi-save"/>
                    </div>

                    <div class="ui-lg-6 ui-fluid">
                        <p:commandButton value="Cancelar" 
                                         onclick="PF('dialogEndereco').hide()" 
                                         styleClass="ui-button-secondary"
                                         icon="pi pi-save"/> 
                    </div>
                </div>
            </p:dialog>
        </h:form>
    </ui:define>
</ui:composition>